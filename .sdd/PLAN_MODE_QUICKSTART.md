# PLAN 模式快速入门指南

欢迎使用增强版 SDD 系统的 PLAN 模式集成！本指南将帮助您理解和使用新的"计划-批准-执行"工作流。

## 什么是 PLAN 模式？

PLAN 模式是一种增强的工作流，AI 助手会在执行任何文件更改**之前**先展示计划供您批准。这让您拥有完全的控制权和可见性。

### Cursor 2.1 改进

**交互式问答：**
- 问题出现在交互式 UI 中（不只是文本）
- 直接在界面中回答
- 更快的工作流

**计划搜索：**
- 使用 ⌘+F 在计划内搜索
- 快速查找章节
- 轻松浏览大型计划

**AI 代码审查：**
- 实现后自动代码审查
- 问题显示在侧边栏
- 直接在编辑器中修复错误

## 魔法公式

```
您的命令 → AI 分析 → AI 展示计划 → 您批准 → AI 执行
```

**核心优势：** 在创建或修改文件之前，您可以先审查和批准。

## 快速对比

### 没有 PLAN 模式（旧方式）
```bash
您: /brief user-auth 添加登录功能
AI:  ✓ 已创建 feature-brief.md
您: *打开文件* "等等，这不是我想要的..."
```

### 使用 PLAN 模式（新方式）
```bash
您: /brief user-auth 添加登录功能
AI:  让我分析一下... 我有些问题：
     - OAuth 还是传统登录？
     - 需要密码重置吗？
     
您: 传统登录，需要密码重置

AI:  这是我的计划：
     - 将创建: specs/active/user-auth/feature-brief.md
     - 结构: 问题、用户、需求、方案
     - 需求: 登录表单、密码重置、邮箱验证
     - 批准吗？
     
您: 完美！继续。

AI:  ✓ 已按计划创建 feature-brief.md
```

## 4 个阶段详解

### 阶段 1：分析 🔍
**AI 做什么：**
- 读取您的请求
- 检查现有文件和模式
- 识别缺失的信息
- 提出澄清问题

**您做什么：**
- 回答问题
- 提供额外上下文
- 澄清需求

**还没有修改文件！** ✅

### 阶段 2：规划 📋
**AI 向您展示：**
- 将要创建/修改的文件
- 结构和内容预览
- 推理和方案
- 预期结果

**您做什么：**
- 仔细审查计划
- 需要时请求修改
- 满意后批准

**仍然没有修改文件！** ✅

### 阶段 3：执行 ⚡
**AI 做什么：**
- 按计划创建/修改文件
- 遵循已批准的方案
- 维持质量标准
- 跟踪进度

**您做什么：**
- 观察执行过程
- 文件按您批准的方式创建

**现在文件被创建了！** 🎉

### 阶段 4：文档化 📝
**AI 做什么：**
- 更新跟踪文件
- 记录决策
- 注明时间戳
- 为下一阶段做准备

**结果：**
- 完整的审计轨迹
- 清晰的文档
- 为下一步做好准备

## 您的第一个 PLAN 模式命令

让我们试一个简单的例子：

```bash
/brief hello-sdd 用简单的 hello world 功能测试 PLAN 模式
```

**将会发生什么：**

1. **AI 分析**（5 秒）
   ```
   正在分析请求...
   - 这是一个测试功能
   - 检查现有模式
   ```

2. **AI 提问**（如果需要）
   ```
   问题：
   - 这个 hello world 功能具体要做什么？
   - 应该是 CLI 命令、网页还是 API 端点？
   ```

3. **您回答**
   ```
   只是测试 - 简单的网页显示"Hello SDD"
   ```

4. **AI 展示计划**
   ```
   /brief hello-sdd 的计划
   
   将创建: specs/active/hello-sdd/feature-brief.md
   
   结构：
   - 问题: 测试 PLAN 模式功能
   - 用户: 学习系统的开发者
   - 需求: 带问候语的简单网页
   - 方案: 带消息的基础 HTML 页面
   - 下一步行动: 创建页面、测试、文档化
   
   批准吗？
   ```

5. **您批准**
   ```
   是的，继续
   ```

6. **AI 执行**
   ```
   正在创建功能简报...
   ✓ 已创建 specs/active/hello-sdd/
   ✓ 已创建 feature-brief.md
   ✓ 已更新 specs/index.md
   
   完成！功能简报已就绪。
   ```

## 常见场景

### 场景 1：AI 提出好问题

```bash
您: /brief checkout-flow 快速结账流程
AI:  问题：
     1. 允许访客结账还是需要登录？
     2. 保存付款方式吗？
     3. 支持国际配送吗？

您: 访客结账，不保存付款，目前仅限美国
AI:  完美！这是我的计划...
```

**提示：** 全面回答问题以获得更好的计划。

### 场景 2：计划需要调整

```bash
AI:  计划: 将创建包含 3 个用户故事的简报...
您: 添加第 4 个用户故事用于购物车放弃恢复
AI:  已更新计划，包含购物车放弃用户故事！
     批准吗？
您: 是的
```

**提示：** 不要犹豫请求修改！

### 场景 3：计划看起来很棒

```bash
AI:  计划: [详细计划]
您: 完美！继续。
AI:  正在执行...
```

**提示：** 明确的批准可以加快执行速度。

## 成功技巧

### 1. 命令要具体
**好的：**
```bash
/brief user-notifications 带偏好设置的邮件和应用内通知
```

**太模糊：**
```bash
/brief notifications 添加通知
```

### 2. 认真回答问题
**好的：**
```
问：哪些通知类型？
答：重要事件用邮件，更新用应用内，紧急警报用推送
```

**太简略：**
```
问：哪些通知类型？
答：全部
```

**注意（Cursor 2.1+）：** 问题出现在交互式 UI 中 - 直接在界面中回答以实现更快的工作流。

### 3. 仔细审查计划
- 阅读整个计划
- 使用 ⌘+F 搜索特定章节（Cursor 2.1+）
- 检查文件路径是否正确
- 验证结构是否合理
- 确保需求被捕获

### 4. 需要时请求修改
如果有不对的地方，不要批准：
```
"等等，还要包括失败通知的错误处理"
"能添加一个关于重试逻辑的部分吗？"
"让我们使用现有的 EmailService 模式"
```

### 5. 信任流程
计划-批准-执行模式一开始可能看起来较慢，但它可以：
- 防止浪费工作
- 及早发现问题
- 产生更好的结果
- 总体节省时间

## 所有命令都使用 PLAN 模式

每个 SDD 命令现在都遵循这个模式：

| 命令 | 批准前您将审查什么 |
|---------|-----------------------------------|
| `/brief` | 简报结构、研究范围、需求 |
| `/evolve` | 建议的更改、前后对比 |
| `/research` | 研究策略、要检查的领域 |
| `/specify` | 规格结构、用户故事 |
| `/plan` | 架构方案、技术决策 |
| `/tasks` | 任务分解、工作量估算 |
| `/implement` | Todo 列表预览、执行顺序 |
| `/upgrade` | 升级策略、文档映射 |

## 如果我不喜欢一个计划怎么办？

您拥有完全的控制权：

### 选项 1：请求修改
```
"在计划中添加安全考虑"
"先关注后端，推迟前端"
"使用 Redis 而不是内存缓存"
```

### 选项 2：提出问题
```
"为什么选择这种方案？"
"你考虑了哪些替代方案？"
"这如何与现有代码集成？"
```

### 选项 3：拒绝并重新开始
```
"让我们用不同的方案重新开始"
"可以简化这个吗？"
"我需要重新考虑需求"
```

## 键盘快捷键

虽然没有特殊快捷键，但可以使用清晰的语言：

**批准：**
- "批准"
- "是的，继续"
- "继续"
- "看起来不错"

**请求修改：**
- "将 X 改为 Y"
- "还要添加 Z"
- "删除关于 W 的部分"

**提出问题：**
- "为什么选择 X？"
- "Y 怎么样？"
- "能解释一下 Z 吗？"

## 高级用法

### 观察跨计划的模式

使用 PLAN 模式几次后，您会注意到：
- 计划中的一致结构
- 类似功能的相似问题
- 正在识别的可重用模式
- AI 从您的偏好中学习

### 提前提供上下文

通过在命令中提供上下文来加快流程：
```bash
/brief payment-integration 
  支持 Stripe 和 PayPal
  为安全进行令牌化
  失败时的重试逻辑
  团队: 2 名开发者
  时间线: 4 周
```

更多上下文 = 更少问题 = 更快批准！

## 故障排除

### "AI 问的问题不够多"
→ 在命令中提供更多上下文

### "计划太详细 / 不够详细"
→ 请求调整："简化这个"或"添加更多细节"
→ 使用 ⌘+F 在计划内搜索并找到特定部分（Cursor 2.1+）

### "AI 一直在问问题"
→ 这是好事！它确保理解。全面回答。
→ 问题出现在交互式 UI 中 - 直接回答以实现更快的工作流（Cursor 2.1+）

### "计划生成时间太长"
→ 请耐心 - 深思熟虑的规划需要时间，但后面会节省更多
→ 对于复杂项目，使用后台规划（Cursor 2.1+）

### "我批准了但想改点东西"
→ 使用 `/evolve` 在创建后更新

### "如何在大计划中找到内容？"
→ 使用 ⌘+F 在计划内搜索（Cursor 2.1+）
→ 搜索关键词、文件路径或章节名称

## 下一步

1. **尝试您的第一个 PLAN 模式命令：**
   ```bash
   /brief test-plan-mode 测试 PLAN 模式工作流
   ```

2. **阅读综合示例：**
   - 参见 [PLAN_MODE_EXAMPLES.md](./PLAN_MODE_EXAMPLES.md)

3. **学习方法论：**
   - 阅读 [guidelines.md](./guidelines.md)

4. **探索所有命令：**
   - 查看 `.cursor/commands/` 目录

5. **理解理念：**
   - 阅读 `.cursor/rules/sdd-system.mdc`

## 关键要点

✅ **您掌控全局** - 没有您的批准什么都不会发生  
✅ **创建前可见** - 在创建文件前审查计划  
✅ **随时询问和调整** - 随时请求修改  
✅ **学习和改进** - 理解 AI 的推理  
✅ **质量保证** - 深思熟虑的规划产生更好的结果  

## 有问题？

- 查看 [PLAN_MODE_EXAMPLES.md](./PLAN_MODE_EXAMPLES.md) 获取详细演练
- 阅读 `.cursor/commands/` 中的特定命令文档
- 查看 [guidelines.md](./guidelines.md) 了解方法论
- 参见 [README.md](../README.md) 获取完整系统概览

---

🎉 **准备好体验 PLAN 模式了吗？**

从一个简单的 `/brief` 命令开始，见证魔法的发生！

```bash
/brief your-feature-name 描述您想要构建什么
```

AI 会引导您完成其余部分！🚀
