---
description: "[L2-GameKit] CommonUI é›†æˆè§„èŒƒ - UI æ¡†æ¶å’Œå¸ƒå±€ç®¡ç†"
globs:
  - "**/UI/**/*"
  - "**/Widget*/**/*"
  - "**/*Widget*.h"
  - "**/*Widget*.cpp"
alwaysApply: false
tags: gamekit, ui, commonui, constraint
level: L2
scope: gamekit-framework
---

# [L2-GameKit] CommonUI é›†æˆè§„èŒƒ

> **å±‚çº§**: L2 (å­ç³»ç»Ÿè§„åˆ™)
> **ç±»å‹**: `constraint` | **é€‚ç”¨ç‰ˆæœ¬**: UE5.7
> **é€‚ç”¨èŒƒå›´**: `gamekit-framework` - ä½¿ç”¨ GameKitCore æ¡†æ¶çš„é¡¹ç›®

---

## 1. UI æ¶æ„æ¦‚è¿°

### [Constraint] åˆ†å±‚æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PrimaryGameLayout                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  UI_Layer_Game        (æ¸¸æˆ HUD)                     â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  UI_Layer_GameMenu    (æ¸¸æˆå†…èœå•)                   â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  UI_Layer_Menu        (ä¸»èœå•)                       â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  UI_Layer_Modal       (æ¨¡æ€å¯¹è¯æ¡†)                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. UI Tag è§„èŒƒ

### [Constraint] æ ‡å‡† UI Tag

| Tag | ç”¨é€” | å±‚çº§ |
|-----|------|------|
| `UI.Layer.Game` | æ¸¸æˆ HUDã€çŠ¶æ€æ  | æœ€åº•å±‚ |
| `UI.Layer.GameMenu` | èƒŒåŒ…ã€æŠ€èƒ½é¢æ¿ç­‰æ¸¸æˆå†…èœå• | ä¸­å±‚ |
| `UI.Layer.Menu` | ä¸»èœå•ã€è®¾ç½®èœå• | é«˜å±‚ |
| `UI.Layer.Modal` | ç¡®è®¤å¯¹è¯æ¡†ã€æç¤ºæ¡† | æœ€é«˜å±‚ |

### [Constraint] Tag å‘½åè§„åˆ™
*   **[Constraint]** å±‚çº§ Tagï¼š`UI.Layer.[å±‚çº§å]`
*   **[Constraint]** Widget æ‰©å±•ç‚¹ Tagï¼š`UI.Extension.[ä½ç½®å]`

---

## 3. PrimaryGameLayout è§„èŒƒ

### [Constraint] Layout èŒè´£
*   **[Constraint]** PrimaryGameLayout æ˜¯æ‰€æœ‰ UI çš„æ ¹å®¹å™¨
*   **[Constraint]** é€šè¿‡ UI Tag ç®¡ç† Widget å±‚çº§
*   **[Constraint]** ä¸€ä¸ª LocalPlayer åªæœ‰ä¸€ä¸ª PrimaryGameLayout

### [Constraint] Layout è·å–æ–¹å¼

```cpp
// âœ… æ­£ç¡®ï¼šé€šè¿‡ UIManagerSubsystem è·å–
UUIManagerSubsystem* UIManager = LocalPlayer->GetSubsystem<UUIManagerSubsystem>();
UGameKitPrimaryGameLayout* Layout = UIManager->GetPrimaryGameLayout();

// âŒ é”™è¯¯ï¼šç›´æ¥åˆ›å»ºæˆ–ç¼“å­˜
UGameKitPrimaryGameLayout* Layout = CreateWidget<UGameKitPrimaryGameLayout>(...);
```

---

## 4. Widget æ·»åŠ è§„èŒƒ

### [Constraint] é€šè¿‡ Action æ·»åŠ  Widget

```cpp
// åœ¨ GameFeatureAction æˆ– ExperienceAction ä¸­æ·»åŠ 
UCLASS()
class UGameKitAction_AddWidgets : public UGameFeatureAction_WorldActionBase
{
    UPROPERTY(EditAnywhere)
    TArray<FGameKitHUDLayoutRequest> Layout;
};

USTRUCT()
struct FGameKitHUDLayoutRequest
{
    // Widget ç±»
    UPROPERTY(EditAnywhere)
    TSoftClassPtr<UCommonActivatableWidget> WidgetClass;
    
    // æ·»åŠ åˆ°çš„å±‚çº§ Tag
    UPROPERTY(EditAnywhere)
    FGameplayTag LayerTag;
};
```

### [Constraint] Widget ç”Ÿå‘½å‘¨æœŸ
*   **[Constraint]** GameFeature åœç”¨æ—¶ç§»é™¤æ·»åŠ çš„ Widget
*   **[Constraint]** Experience åˆ‡æ¢æ—¶æ¸…ç†æ—§ Widget

---

## 5. CommonActivatableWidget è§„èŒƒ

### [Constraint] ä½¿ç”¨ CommonActivatableWidget
*   **[Constraint]** æ‰€æœ‰å¯æ¿€æ´»çš„ UI ç»§æ‰¿ `UCommonActivatableWidget`
*   **[Constraint]** åˆ©ç”¨ Activate/Deactivate ç®¡ç†çŠ¶æ€

```cpp
UCLASS()
class UMyGameWidget : public UCommonActivatableWidget
{
    virtual void NativeOnActivated() override
    {
        Super::NativeOnActivated();
        // Widget æ¿€æ´»æ—¶çš„é€»è¾‘
    }
    
    virtual void NativeOnDeactivated() override
    {
        Super::NativeOnDeactivated();
        // Widget åœç”¨æ—¶çš„é€»è¾‘
    }
};
```

---

## 6. UIExtension æ‰©å±•ç‚¹è§„èŒƒ

### [Constraint] æ‰©å±•ç‚¹ç”¨é€”
- å…è®¸ GameFeature å‘å·²å­˜åœ¨çš„ UI æ·»åŠ å†…å®¹
- æ— éœ€ä¿®æ”¹åŸºç¡€ UI ä»£ç 

### [Constraint] æ‰©å±•ç‚¹å®šä¹‰

```cpp
// åœ¨åŸºç¡€ UI ä¸­å®šä¹‰æ‰©å±•ç‚¹
UPROPERTY(meta = (BindWidget))
UUIExtensionPointWidget* ExtensionPoint_ActionBar;

// é…ç½®æ‰©å±•ç‚¹ Tag
ExtensionPoint_ActionBar->ExtensionPointTag = FGameplayTag::RequestGameplayTag("UI.Extension.ActionBar");
```

### [Constraint] å‘æ‰©å±•ç‚¹æ·»åŠ å†…å®¹

```cpp
// åœ¨ GameFeature ä¸­å‘æ‰©å±•ç‚¹æ·»åŠ  Widget
UIExtensionSubsystem->RegisterExtensionAsWidgetForContext(
    ExtensionPointTag,
    PlayerController,
    WidgetClass,
    -1  // æ’åºä¼˜å…ˆçº§
);
```

---

## 7. å‘½åè§„èŒƒ

### [Constraint] Widget ç±»å‘½å

| ç±»å‹ | å‰ç¼€ | ç¤ºä¾‹ |
|------|------|------|
| åŸºç¡€ Widget | `UW_` | `UW_HealthBar`, `UW_MiniMap` |
| å±å¹•/é¡µé¢ | `UWS_` | `UWS_MainMenu`, `UWS_Inventory` |
| å¼¹çª—/å¯¹è¯æ¡† | `UWD_` | `UWD_Confirm`, `UWD_Settings` |
| Layout | - | `UGameKitPrimaryGameLayout` |

### [Constraint] èµ„äº§å‘½å
*   **[Constraint]** Widget è“å›¾ï¼š`WBP_[åç§°]`ï¼ˆå¦‚ `WBP_HealthBar`ï¼‰

---

## âœ… æ£€æŸ¥æ¸…å•

- [ ] ä½¿ç”¨æ ‡å‡† UI Layer Tag
- [ ] é€šè¿‡ UIManagerSubsystem è·å– PrimaryGameLayout
- [ ] Widget ç»§æ‰¿ CommonActivatableWidget
- [ ] GameFeature åœç”¨æ—¶ç§»é™¤æ·»åŠ çš„ Widget
- [ ] Widget å‘½åç¬¦åˆè§„èŒƒ

---

**è®°ä½**ï¼š
- ğŸ¯ **åˆ†å±‚ç®¡ç†**ï¼šé€šè¿‡ UI Tag ç®¡ç†å±‚çº§
- ğŸ¯ **æ‰©å±•ç‚¹æ¨¡å¼**ï¼šæ— éœ€ä¿®æ”¹åŸºç¡€ UI å³å¯æ‰©å±•
- ğŸ¯ **ç”Ÿå‘½å‘¨æœŸé—­ç¯**ï¼šæ·»åŠ å¿…æœ‰ç§»é™¤

---

**å±‚çº§**: L2-GameKit | **æœ€åæ›´æ–°**: 2026å¹´2æœˆ
