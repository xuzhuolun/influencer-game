---
description: "[L1-UE5] æ ¸å¿ƒå¼€å‘è§„èŒƒ - C++ã€å†…å­˜ã€æ¶æ„ã€æ€§èƒ½"
globs:
  - "**/*.h"
  - "**/*.cpp"
  - "**/*.cs"
alwaysApply: true
tags: ue5, cpp, constraint, pdca
level: L1
scope: ue5-universal
---

# [L1-UE5] æ ¸å¿ƒå¼€å‘è§„èŒƒ

> **å±‚çº§**: L1 (é€šç”¨å·¥ç¨‹è§„åˆ™)
> **ç±»å‹**: `constraint` | **é€‚ç”¨ç‰ˆæœ¬**: UE5.7
> **é€‚ç”¨èŒƒå›´**: `ue5-universal` - æ‰€æœ‰ UE5 é¡¹ç›®é€šç”¨

## ğŸ” æºç å­¦ä¹ æé†’

**é‡è¦ï¼šæ¯æ¬¡å¼€å‘å‰ï¼Œè¯·å…ˆæŸ¥é˜… UE5 æºç ç›®å½•å’Œ AI æ–‡æ¡£ä¸­å¿ƒ**
- Runtimeæºç ï¼š`UE5_7/EngineCode/Source/Runtime/`
- Editoræºç ï¼š`UE5_7/EngineCode/Source/Editor/`
- å¼•æ“AIæ–‡æ¡£ä¸­å¿ƒï¼š`UE5_7/å¼•æ“AIæ–‡æ¡£ä¸­å¿ƒ/`

---

## 1. C++ æ ¸å¿ƒè§„èŒƒ

### [Constraint] å‘½åè§„èŒƒ
*   **[Constraint]** ä¸¥æ ¼éµå¾ª UE å‰ç¼€: `UObject`, `AActor`, `FStruct`, `EEnum`, `IInterface`, `bBool`
*   **[Constraint]** æ–‡ä»¶åå¿…é¡»ä¸ç±»åå®Œå…¨åŒ¹é…ï¼ˆä¸å«å‰ç¼€ï¼‰

### [Constraint] ä»£ç ç»“æ„
*   **åŒ…å«é¡ºåº**: 1. `MyClass.h` â†’ 2. `CoreMinimal.h` â†’ 3. `Engine/World.h` â†’ 4. `MyProject/...`

---

## 2. å†…å­˜ç®¡ç†

### [Constraint] UObject ç®¡ç†
*   **[Constraint]** UObject æˆå‘˜ä½¿ç”¨ `TObjectPtr`
*   **[Constraint]** é UObject ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆ (`TSharedPtr`)
*   **[Constraint]** ä¸¥ç¦è£¸æŒ‡é’ˆæ‹¥æœ‰èµ„æº

### [Constraint] è½¯å¼•ç”¨é™·é˜± âš ï¸
*   **[Constraint]** è½¯å¼•ç”¨å¿…é¡»ç”¨ `IsNull()` æ£€æŸ¥é…ç½®ï¼Œç¦æ­¢ç”¨ `IsValid()`ï¼ˆé˜²æ­¢è¯¯åˆ¤æœªåŠ è½½èµ„äº§ï¼‰

```cpp
// âŒ é”™è¯¯ï¼šä½¿ç”¨ IsValid() æ£€æŸ¥è½¯å¼•ç”¨
if (!WidgetClass.IsValid()) { return; }

// âœ… æ­£ç¡®ï¼šä½¿ç”¨ IsNull() æ£€æŸ¥
if (WidgetClass.IsNull()) { return; }
UClass* LoadedClass = WidgetClass.LoadSynchronous();
```

---

## 3. æ¶æ„æ¨¡å¼

### [Constraint] Static å˜é‡é™·é˜± ğŸ”¥
*   **[Constraint]** ä¸¥ç¦åœ¨åˆå§‹åŒ–å‡½æ•°ä¸­ä½¿ç”¨ `static` å˜é‡æ ‡è®°çŠ¶æ€
*   **åŸå› **: PIE æ¨¡å¼ä¸‹ `static` å˜é‡ä¸é‡ç½®ï¼Œå¯¼è‡´äºŒæ¬¡è¿è¡Œé€»è¾‘é”™è¯¯
*   **Fix**: çŠ¶æ€å­˜ `GameInstance` æˆ– `Subsystem` æˆå‘˜å˜é‡

### [Suggestion] Subsystem ä¼˜å…ˆ
*   **[Suggestion]** ä½¿ç”¨ `Subsystem` æ›¿ä»£ `Manager` Actor
*   âš ï¸ **ä¾‹å¤–**: å¦‚éœ€ RPCï¼Œåº”ä½¿ç”¨ `UActorComponent` æˆ–æœ‰ `NetConnection` çš„ Actor

### [Constraint] å¾ªç¯ä¾èµ–
*   **[Constraint]** å°†å…±äº«å®šä¹‰è¿ç§»åˆ° `GameKitCore` æˆ–å…¬å…±åŸºç¡€æ¨¡å—

---

## 4. ç”Ÿå‘½å‘¨æœŸé—­ç¯ ğŸ”„

### [Constraint] èµ„æºé—­ç¯åŸåˆ™
*   **[Constraint]** ä»»ä½•"æ¿€æ´»/åŠ è½½"æ“ä½œå¿…é¡»æœ‰å¯¹åº”çš„"åœç”¨/å¸è½½"é€»è¾‘
*   **[Constraint]** EndPlay/Shutdown æ—¶å¿…é¡»æ¸…ç†æ‰€æœ‰åŠ¨æ€åŠ è½½çš„èµ„æº
*   **[Constraint]** ç¼–è¾‘å™¨ç¯å¢ƒéœ€è¦å¼•ç”¨è®¡æ•°ç®¡ç†ï¼ˆPIE å¤šå®ä¾‹åœºæ™¯ï¼‰

### [Constraint] GameFeature é—­ç¯ï¼ˆå‚è€ƒ Lyraï¼‰
*   **[Constraint]** æ¿€æ´»æ—¶ï¼šå¼•ç”¨è®¡æ•° +1
*   **[Constraint]** åœç”¨æ—¶ï¼šå¼•ç”¨è®¡æ•° -1ï¼Œå½’é›¶æ‰çœŸæ­£ Deactivate
*   **[Constraint]** EndPlay å¿…é¡»è°ƒç”¨åœç”¨é€»è¾‘

```cpp
// âœ… æ­£ç¡®ï¼šå®Œæ•´é—­ç¯
void OnGameFeatureActivated(const FString& URL) {
    NotifyOfPluginActivation(URL);  // è®¡æ•° +1
    LoadedPlugins.Add(URL);
}

void EndPlay(...) {
    for (const FString& URL : LoadedPlugins) {
        if (RequestToDeactivatePlugin(URL)) {  // è®¡æ•° -1ï¼Œå½’é›¶æ‰åœç”¨
            UGameFeaturesSubsystem::Get().DeactivateGameFeaturePlugin(URL);
        }
    }
}

// âŒ é”™è¯¯ï¼šåªæ¿€æ´»ä¸åœç”¨
void LoadExperience(...) {
    UGameFeaturesSubsystem::Get().LoadAndActivateGameFeaturePlugin(URL, ...);
    // EndPlay é‡Œæ²¡æœ‰ Deactivate â†’ PIE çŠ¶æ€æ®‹ç•™
}
```

---

## 5. æ€§èƒ½ä¼˜åŒ–

### [Constraint] Tick ä¼˜åŒ–
*   **[Constraint]** é»˜è®¤ `bCanEverTick = false`
*   **[Suggestion]** å¿…é¡» Tick æ—¶è®¾ç½®é—´éš”: `PrimaryActorTick.TickInterval = 0.1f;`

---

## 6. åå°„å®è§„èŒƒ

### [Constraint] åå°„çº¦æŸ
*   **[Constraint]** æš´éœ²ç»™è“å›¾çš„å‡½æ•°å¿…é¡»å¸¦ Category
*   **[Constraint]** ç»“æ„ä½“å¿…é¡»å¯è“å›¾è®¿é—®: `USTRUCT(BlueprintType)`

---

## 7. è°ƒè¯•å®

```cpp
check(Condition);              // æ–­è¨€ï¼Œå¤±è´¥ä¼šå´©æºƒ
ensure(Condition);             // ç¡®ä¿ï¼Œå¤±è´¥ä¼šæŠ¥å‘Šä½†ç»§ç»­æ‰§è¡Œ
checkSlow(Condition);          // ä»…åœ¨Debugé…ç½®ä¸‹æ£€æŸ¥
```

---

**è®°ä½**ï¼š
- ğŸ¯ **å‘½åè§„èŒƒ**: U/A/I/E/F/T/b å‰ç¼€
- ğŸ¯ **è½¯å¼•ç”¨é™·é˜±**: ä½¿ç”¨ IsNull() è€Œé IsValid()
- ğŸ¯ **PIE æ¨¡å¼é™·é˜±**: ç»ä¸åœ¨åˆå§‹åŒ–é€»è¾‘ä¸­ä½¿ç”¨ static bool
- ğŸ¯ **å¾ªç¯ä¾èµ–**: è¿ç§»å…±äº«å®šä¹‰åˆ° GameKitCore

---

**å±‚çº§**: L1-UE5 | **æœ€åæ›´æ–°**: 2026å¹´2æœˆ
