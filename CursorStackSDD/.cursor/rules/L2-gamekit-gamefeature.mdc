---
description: "[L2-GameKit] GameFeature å¼€å‘è§„èŒƒ - æ¨¡å—åŒ–åŠŸèƒ½æ’ä»¶å¼€å‘"
globs:
  - "**/GameFeatures/**/*"
  - "**/GameFeature_*/**/*"
alwaysApply: true
tags: gamekit, gamefeature, constraint, pdca
level: L2
scope: gamekit-framework
---

# [L2-GameKit] GameFeature å¼€å‘è§„èŒƒ

> **å±‚çº§**: L2 (å­ç³»ç»Ÿè§„åˆ™)
> **ç±»å‹**: `constraint` | **é€‚ç”¨ç‰ˆæœ¬**: UE5.7
> **é€‚ç”¨èŒƒå›´**: `gamekit-framework` - ä½¿ç”¨ GameKitCore æ¡†æ¶çš„é¡¹ç›®

---

## 1. GameFeature æ ¸å¿ƒæ¦‚å¿µ

### ä»€ä¹ˆæ˜¯ GameFeatureï¼Ÿ
- **æ¨¡å—åŒ–åŠŸèƒ½å•å…ƒ**ï¼šå°†æ¸¸æˆåŠŸèƒ½å°è£…ä¸ºç‹¬ç«‹æ’ä»¶
- **åŠ¨æ€åŠ è½½/å¸è½½**ï¼šè¿è¡Œæ—¶æŒ‰éœ€æ¿€æ´»
- **Experience é©±åŠ¨**ï¼šé€šè¿‡ Experience é…ç½®è‡ªåŠ¨æ¿€æ´»

```
Experience (å®šä¹‰"æ¸¸æˆä½“éªŒ")
    â”‚
    â–¼
GameFeatureData (åˆ—å‡ºéœ€è¦çš„åŠŸèƒ½)
    â”‚
    â–¼
GameFeatureAction (æ‰§è¡Œå…·ä½“æ“ä½œ)
    â”‚
    â–¼
åŠŸèƒ½æ¿€æ´»ï¼ˆæ·»åŠ ç»„ä»¶ã€UIã€èƒ½åŠ›ç­‰ï¼‰
```

---

## 2. ç›®å½•ç»“æ„è§„èŒƒ

### [Constraint] æ’ä»¶ç›®å½•ç»“æ„

```
Plugins/GameFeatures/
â””â”€â”€ GameFeature_[åŠŸèƒ½å]/
    â”œâ”€â”€ GameFeature_[åŠŸèƒ½å].uplugin
    â”œâ”€â”€ Content/
    â”‚   â””â”€â”€ [åŠŸèƒ½å]_GameFeatureData.uasset
    â”œâ”€â”€ Source/
    â”‚   â””â”€â”€ GameFeature_[åŠŸèƒ½å]/
    â”‚       â”œâ”€â”€ GameFeature_[åŠŸèƒ½å].Build.cs
    â”‚       â”œâ”€â”€ Public/
    â”‚       â””â”€â”€ Private/
    â””â”€â”€ README.md
```

### [Constraint] å‘½åè§„èŒƒ
*   **[Constraint]** æ’ä»¶åï¼š`GameFeature_[åŠŸèƒ½å]`ï¼ˆå¦‚ `GameFeature_Combat`ï¼‰
*   **[Constraint]** GameFeatureData èµ„äº§åï¼š`[åŠŸèƒ½å]_GameFeatureData`

---

## 3. ç”Ÿå‘½å‘¨æœŸé—­ç¯ ğŸ”„

### [Constraint] æ¿€æ´»/åœç”¨é—­ç¯åŸåˆ™

```
æ¿€æ´»æµç¨‹ï¼š
Experience åŠ è½½ â†’ GameFeature æ¿€æ´» â†’ å¼•ç”¨è®¡æ•° +1 â†’ æ‰§è¡Œ Actions

åœç”¨æµç¨‹ï¼š
Experience å¸è½½ â†’ è¯·æ±‚åœç”¨ â†’ å¼•ç”¨è®¡æ•° -1 â†’ å½’é›¶æ—¶çœŸæ­£åœç”¨
```

### [Constraint] å¼•ç”¨è®¡æ•°ç®¡ç†
*   **[Constraint]** æ¿€æ´»æ—¶ï¼šå¼•ç”¨è®¡æ•° +1
*   **[Constraint]** åœç”¨æ—¶ï¼šå¼•ç”¨è®¡æ•° -1ï¼Œå½’é›¶æ‰çœŸæ­£ Deactivate
*   **[Constraint]** EndPlay å¿…é¡»è°ƒç”¨åœç”¨é€»è¾‘

```cpp
// âœ… æ­£ç¡®ï¼šå®Œæ•´é—­ç¯
void UGameKitExperienceManagerComponent::OnGameFeaturePluginLoadComplete(...)
{
    // æ¿€æ´»æ—¶è®°å½•
    NumGameFeaturePluginsLoading--;
    NotifyOfPluginActivation(PluginURL);  // è®¡æ•° +1
    GameFeaturePluginURLs.Add(PluginURL);
}

void UGameKitExperienceManagerComponent::EndPlay(...)
{
    // åœç”¨æ—¶æ¸…ç†
    for (const FString& PluginURL : GameFeaturePluginURLs)
    {
        if (RequestToDeactivatePlugin(PluginURL))  // è®¡æ•° -1
        {
            UGameFeaturesSubsystem::Get().DeactivateGameFeaturePlugin(PluginURL);
        }
    }
}

// âŒ é”™è¯¯ï¼šåªæ¿€æ´»ä¸åœç”¨
void BadExample()
{
    UGameFeaturesSubsystem::Get().LoadAndActivateGameFeaturePlugin(URL, ...);
    // EndPlay é‡Œæ²¡æœ‰ Deactivate â†’ PIE çŠ¶æ€æ®‹ç•™
}
```

---

## 4. GameFeatureAction è§„èŒƒ

### [Constraint] Action ç±»å‹
*   **AddComponents**: æ·»åŠ ç»„ä»¶åˆ° Actor
*   **AddWidgets**: æ·»åŠ  UI åˆ°å¸ƒå±€
*   **AddAbilities**: æ·»åŠ  GAS èƒ½åŠ›
*   **è‡ªå®šä¹‰ Action**: ç»§æ‰¿ `UGameFeatureAction_WorldActionBase`

### [Constraint] Action å®ç°è§„åˆ™
*   **[Constraint]** æ‰€æœ‰æ·»åŠ æ“ä½œå¿…é¡»æœ‰å¯¹åº”çš„ç§»é™¤é€»è¾‘
*   **[Constraint]** åœ¨ `OnGameFeatureDeactivating` ä¸­æ¸…ç†èµ„æº

```cpp
// âœ… æ­£ç¡®ï¼šå®Œæ•´çš„ Action å®ç°
class UGameKitAction_AddWidgets : public UGameFeatureAction_WorldActionBase
{
    virtual void OnGameFeatureActivating(FGameFeatureActivatingContext& Context) override
    {
        // æ·»åŠ  Widget
        AddedWidgets.Add(CreatedWidget);
    }
    
    virtual void OnGameFeatureDeactivating(FGameFeatureDeactivatingContext& Context) override
    {
        // ç§»é™¤ Widget
        for (auto Widget : AddedWidgets)
        {
            Widget->RemoveFromParent();
        }
        AddedWidgets.Empty();
    }
};
```

---

## 5. ä¾èµ–è§„åˆ™

### [Constraint] GameFeature ä¾èµ–çº¦æŸ
*   **[Constraint]** GameFeature å¯ä»¥ä¾èµ– GameKitCore âœ…
*   **[Constraint]** GameFeature ä¹‹é—´ä¸åº”ç›¸äº’ä¾èµ– âŒ
*   **[Constraint]** å…¶ä»–æ’ä»¶ä¸åº”ä¾èµ– GameFeature âŒ

```
GameFeature_Combat  â†’  GameKitCore       âœ…
GameFeature_Combat  â†’  GameFeature_UI    âŒ
MyProjectModule     â†’  GameFeature_Combat âŒ
```

---

## 6. PIE å¤šå®ä¾‹æ”¯æŒ

### [Constraint] PIE å…¼å®¹æ€§
*   **[Constraint]** ä½¿ç”¨å¼•ç”¨è®¡æ•°ç®¡ç† GameFeature çŠ¶æ€
*   **[Constraint]** é¿å…ä½¿ç”¨ static å˜é‡å­˜å‚¨çŠ¶æ€
*   **[Constraint]** EndPlay æ—¶æ­£ç¡®æ¸…ç†

---

## âœ… æ£€æŸ¥æ¸…å•

- [ ] æ’ä»¶ç›®å½•ç»“æ„ç¬¦åˆè§„èŒƒ
- [ ] å‘½åç¬¦åˆ `GameFeature_[åŠŸèƒ½å]` æ ¼å¼
- [ ] æ¿€æ´»/åœç”¨é—­ç¯å®Œæ•´
- [ ] Action æœ‰å¯¹åº”çš„æ¸…ç†é€»è¾‘
- [ ] æ—  GameFeature é—´ç›¸äº’ä¾èµ–
- [ ] PIE å¤šå®ä¾‹æµ‹è¯•é€šè¿‡

---

**è®°ä½**ï¼š
- ğŸ¯ **é—­ç¯åŸåˆ™**ï¼šæ¿€æ´»å¿…æœ‰åœç”¨
- ğŸ¯ **å¼•ç”¨è®¡æ•°**ï¼šå½’é›¶æ‰çœŸæ­£åœç”¨
- ğŸ¯ **æ— ç›¸äº’ä¾èµ–**ï¼šGameFeature ä¹‹é—´ç‹¬ç«‹

---

**å±‚çº§**: L2-GameKit | **æœ€åæ›´æ–°**: 2026å¹´2æœˆ
