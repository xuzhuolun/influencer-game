---
description: "[L2-GameKit] Experience ç³»ç»Ÿè§„èŒƒ - æ¸¸æˆä½“éªŒé…ç½®å’ŒåŠ è½½"
globs:
  - "**/Experience/**/*"
  - "**/*Experience*.uasset"
alwaysApply: true
tags: gamekit, experience, constraint, pdca
level: L2
scope: gamekit-framework
---

# [L2-GameKit] Experience ç³»ç»Ÿè§„èŒƒ

> **å±‚çº§**: L2 (å­ç³»ç»Ÿè§„åˆ™)
> **ç±»å‹**: `constraint` | **é€‚ç”¨ç‰ˆæœ¬**: UE5.7
> **é€‚ç”¨èŒƒå›´**: `gamekit-framework` - ä½¿ç”¨ GameKitCore æ¡†æ¶çš„é¡¹ç›®

---

## 1. Experience æ ¸å¿ƒæ¦‚å¿µ

### ä»€ä¹ˆæ˜¯ Experienceï¼Ÿ
- **æ¸¸æˆä½“éªŒå®šä¹‰**ï¼šæè¿°ä¸€ç§å®Œæ•´çš„æ¸¸æˆä½“éªŒï¼ˆå¦‚ä¸»èœå•ã€æˆ˜æ–—å…³å¡ã€åŸé•‡ï¼‰
- **é…ç½®åŒ–å…¥å£**ï¼šé€šè¿‡æ•°æ®èµ„äº§é…ç½®ï¼Œæ— éœ€ç¡¬ç¼–ç 
- **GameFeature ç¼–æ’**ï¼šå®šä¹‰éœ€è¦æ¿€æ´»å“ªäº› GameFeature

```
WorldSettings æŒ‡å®š Experience
       â”‚
       â–¼
ExperienceManagerComponent åŠ è½½ Experience
       â”‚
       â–¼
æ¿€æ´» GameFeature åˆ—è¡¨
       â”‚
       â–¼
æ‰§è¡Œ ActionSet
       â”‚
       â–¼
é€šçŸ¥ Experience åŠ è½½å®Œæˆ
```

---

## 2. Experience Definition è§„èŒƒ

### [Constraint] ExperienceDefinition ç»“æ„

```cpp
UCLASS(BlueprintType)
class UGameKitExperienceDefinition : public UPrimaryDataAsset
{
    // éœ€è¦æ¿€æ´»çš„ GameFeature åˆ—è¡¨
    UPROPERTY(EditDefaultsOnly)
    TArray<FString> GameFeaturesToEnable;
    
    // åŠ è½½å®Œæˆåæ‰§è¡Œçš„ ActionSet
    UPROPERTY(EditDefaultsOnly)
    TArray<TObjectPtr<UGameKitExperienceActionSet>> ActionSets;
    
    // é»˜è®¤ PawnDataï¼ˆå¯é€‰ï¼‰
    UPROPERTY(EditDefaultsOnly)
    TObjectPtr<UGameKitPawnData> DefaultPawnData;
};
```

### [Constraint] å‘½åè§„èŒƒ
*   **[Constraint]** Experience èµ„äº§åï¼š`EXP_[ä½“éªŒå]`ï¼ˆå¦‚ `EXP_MainMenu`, `EXP_Combat`ï¼‰
*   **[Constraint]** å­˜æ”¾è·¯å¾„ï¼š`Content/Logic/Experiences/`

---

## 3. Experience åŠ è½½æµç¨‹

### [Constraint] åŠ è½½çŠ¶æ€æœº

```
Unloaded â†’ Loading â†’ LoadingGameFeatures â†’ ExecutingActions â†’ Loaded
    â”‚                                                           â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Unloading â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### [Constraint] åŠ è½½è§„åˆ™
*   **[Constraint]** Experience ç”± `ExperienceManagerComponent` ç®¡ç†
*   **[Constraint]** ä¸€ä¸ª World åŒæ—¶åªèƒ½æœ‰ä¸€ä¸ª Experience å¤„äº Loaded çŠ¶æ€
*   **[Constraint]** åˆ‡æ¢ Experience å‰å¿…é¡»å…ˆå¸è½½å½“å‰ Experience

---

## 4. ActionSet è§„èŒƒ

### [Constraint] ActionSet ç”¨é€”
- åœ¨ Experience åŠ è½½å®Œæˆåæ‰§è¡Œçš„ä¸€ç»„æ“ä½œ
- ä¸ GameFeatureAction ç±»ä¼¼ï¼Œä½†å±äº Experience çº§åˆ«

### [Constraint] å¸¸ç”¨ Action ç±»å‹
*   **AddWidgets**: æ·»åŠ  UI åˆ° PrimaryGameLayout
*   **AddComponents**: æ·»åŠ ç»„ä»¶åˆ°æŒ‡å®š Actor
*   **SpawnActors**: ç”Ÿæˆ Actor åˆ°ä¸–ç•Œ

```cpp
// ActionSet ç¤ºä¾‹
UCLASS()
class UGameKitExperienceActionSet : public UPrimaryDataAsset
{
    UPROPERTY(EditDefaultsOnly)
    TArray<TObjectPtr<UGameFeatureAction>> Actions;
};
```

---

## 5. WorldSettings é›†æˆ

### [Constraint] æŒ‡å®šé»˜è®¤ Experience
*   **[Constraint]** é€šè¿‡ `WorldSettings` çš„ `DefaultExperience` å±æ€§æŒ‡å®š
*   **[Constraint]** å¯åœ¨è“å›¾æˆ– C++ ä¸­åŠ¨æ€åˆ‡æ¢

```cpp
// åœ¨ WorldSettings ä¸­é…ç½®
UPROPERTY(EditAnywhere, Category = "GameKit|Experience")
TSoftObjectPtr<UGameKitExperienceDefinition> DefaultExperience;
```

---

## 6. Experience åŠ è½½äº‹ä»¶

### [Constraint] äº‹ä»¶é€šçŸ¥
*   **[Constraint]** ä½¿ç”¨å§”æ‰˜é€šçŸ¥ Experience åŠ è½½å®Œæˆ
*   **[Constraint]** å…¶ä»–ç³»ç»Ÿåº”ç­‰å¾… Experience åŠ è½½å®Œæˆåå†åˆå§‹åŒ–

```cpp
// ç­‰å¾… Experience åŠ è½½å®Œæˆ
void AMyActor::BeginPlay()
{
    Super::BeginPlay();
    
    if (UGameKitExperienceManagerComponent* ExpManager = FindExperienceManager())
    {
        ExpManager->CallOrRegister_OnExperienceLoaded(
            FOnExperienceLoaded::FDelegate::CreateUObject(this, &AMyActor::OnExperienceLoaded)
        );
    }
}

void AMyActor::OnExperienceLoaded(const UGameKitExperienceDefinition* Experience)
{
    // Experience åŠ è½½å®Œæˆï¼Œå¯ä»¥å®‰å…¨åˆå§‹åŒ–
}
```

---

## 7. ä¸ GameFeature çš„å…³ç³»

```
Experience (é«˜å±‚é…ç½®)
    â”‚
    â”œâ”€â”€ å®šä¹‰éœ€è¦å“ªäº› GameFeature
    â”‚
    â””â”€â”€ å®šä¹‰ ActionSetï¼ˆExperience çº§åˆ«æ“ä½œï¼‰
    
GameFeature (åŠŸèƒ½æ¨¡å—)
    â”‚
    â””â”€â”€ å®šä¹‰ GameFeatureActionï¼ˆåŠŸèƒ½çº§åˆ«æ“ä½œï¼‰
```

### [Constraint] èŒè´£åˆ’åˆ†
*   **Experience**: ç¼–æ’å’Œé…ç½®
*   **GameFeature**: åŠŸèƒ½å®ç°

---

## âœ… æ£€æŸ¥æ¸…å•

- [ ] ExperienceDefinition å‘½åç¬¦åˆ `EXP_[ä½“éªŒå]` æ ¼å¼
- [ ] é€šè¿‡ WorldSettings æ­£ç¡®æŒ‡å®šé»˜è®¤ Experience
- [ ] å…¶ä»–ç³»ç»Ÿç­‰å¾… Experience åŠ è½½å®Œæˆåå†åˆå§‹åŒ–
- [ ] Experience åˆ‡æ¢æ—¶æ­£ç¡®å¸è½½æ—§ Experience
- [ ] ActionSet æœ‰å¯¹åº”çš„æ¸…ç†é€»è¾‘

---

**è®°ä½**ï¼š
- ğŸ¯ **Experience æ˜¯å…¥å£**ï¼šå®šä¹‰æ¸¸æˆä½“éªŒçš„é…ç½®
- ğŸ¯ **ç­‰å¾…åŠ è½½å®Œæˆ**ï¼šå…¶ä»–ç³»ç»Ÿåº”ç­‰å¾… Experience å°±ç»ª
- ğŸ¯ **ä¸€ä¸ª World ä¸€ä¸ª Experience**ï¼šåŒæ—¶åªèƒ½æœ‰ä¸€ä¸ªæ¿€æ´»

---

**å±‚çº§**: L2-GameKit | **æœ€åæ›´æ–°**: 2026å¹´2æœˆ
